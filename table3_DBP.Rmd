---
title: "The Natural History of Hypertension in Older Adults: A Study of Two Finnish Generational Cohorts Born 20 Years Apart - diastolic BP analyses"
output:
  html_document: default
#  pdf_document: default
classoption: landscape
date: "`r Sys.Date()`"
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Load libraries
library(dplyr)
library(pacman)

# Load the rest
p_load(ggplot2, ggthemes, dplyr, knitr, kableExtra, here, lubridate, tidyverse, janitor, psych)

# Format the kable styling
bs_style <- c("striped", "bordered")

options(kable_styling_bootstrap_options = bs_style)

```
<br><br><br><br>



# Introduce a special function that stylizes p-values

The following code chunk introduces a special function that stylizes p-values.


<br><br><br>
```{r stylize_p}
 stylize_p <- function(x) {
  case_when(
    x < 0.001 ~ "<.001",
    x >= 0.001 & x < 0.005 ~ as.character(format(round_half_up(x, 3), nsmall = 3)),
    
    x >= 0.005 & x < 0.045 ~ as.character(format(round_half_up(x, 2), nsmall = 2)),
    x >= 0.045 & x < 0.055 ~ as.character(format(round_half_up(x, 3), nsmall = 3)),
    x >= 0.055 ~ as.character(format(round_half_up(x, 2), nsmall = 2)),
    TRUE ~ "other"
  )
}



```
<br><br><br>
  

# Load the datasets with the {here} package
<br><br>



```{r here_package}

# Tell the "here" package where you are right now - i.e. tell the location of the file you are running right now

here::i_am("article1/table3_DBP.Rmd")

# After that, you can check where the project root is by running "here()"

here()



#  Load the datasets using {here} package
article1tuva_file <- here("data", "tuva.rds")
article1utuva_file <- here("data", "utuva.rds")

article1tuva <- readRDS(article1tuva_file)
article1utuva <- readRDS(article1utuva_file)

# Clean up variables
rm(article1tuva_file, article1utuva_file)

```





# Exclusion of participants in the baseline without data for SBP and/or DBP
<br><br>

We will exclude those who don't have both an SBP and a DBP reading in the baseline.

TUVA1:


```{r exclusion_tuva1, echo=FALSE}

# TUVA1
article1tuva <- article1tuva %>% drop_na(SRR_70_istuen, SRRD_70_istuen)
article1tuva %>% nrow()


```


UTUVA1:

```{r exclusion_utuva1, echo=FALSE}
# UTUVA1
article1utuva <- article1utuva %>% drop_na(B8_3_A7isys_U70, B8_3_A7idia_U70)
article1utuva %>% nrow()

```





# Some of the BP data is in wrong format - fix that and give variables easier names
<br><br>

TUVA5 has non-numeric data for BP.


```{r fix_bp_data_tuva5, echo=TRUE}

article1tuva$DBP_TUVA1 <-  article1tuva$SRRD_70_istuen 
article1tuva$DBP_TUVA2 <-  article1tuva$SRRD_80_istuen 
article1tuva$DBP_TUVA3 <-  article1tuva$SRRD_istuen_85 
article1tuva$DBP_TUVA4 <-  article1tuva$SRRD_90_istuen 
article1tuva$DBP_TUVA5 <- as.numeric(article1tuva$FYSMIT6b1b)


article1utuva$DBP_UTUVA1 <- article1utuva$B8_3_A7idia_U70
article1utuva$DBP_UTUVA2 <- article1utuva$B10b_A7_2_2_U75
article1utuva$DBP_UTUVA3 <- as.numeric(article1utuva$RR_diast_ist_U80)

article1utuva <- article1utuva %>%
  mutate(DBP_UTUVA3 = ifelse(DBP_UTUVA3 == 0, NA, DBP_UTUVA3)) 




```


# Confirm how the variables look with histograms and so on
<br><br>

```{r fix_bp_data_utuva3, echo=TRUE}

article1tuva %>% select(DBP_TUVA1, DBP_TUVA2, DBP_TUVA3, DBP_TUVA4, DBP_TUVA5) %>% multi.hist(., global = FALSE)
 
article1tuva %>% select(DBP_TUVA1, DBP_TUVA2, DBP_TUVA3, DBP_TUVA4, DBP_TUVA5) %>% describe(.)


article1utuva %>% select(DBP_UTUVA1, DBP_UTUVA2, DBP_UTUVA3) %>% multi.hist(., global = FALSE)

article1utuva %>% select(DBP_UTUVA1, DBP_UTUVA2, DBP_UTUVA3) %>% describe(.)


```



# Count the n numbers of available BP readings for Table 2
<br><br>

Store these into a vector and display the values.

<br><br><br>
```{r n_numbers}

# TUVA1

tuva1_n <- sum(!is.na(article1tuva$DBP_TUVA1))
tuva1_n
 


# TUVA2
tuva2_n <- sum(!is.na(article1tuva$DBP_TUVA2))
tuva2_n


#TUVA3
tuva3_n <- sum(!is.na(article1tuva$DBP_TUVA3))
tuva3_n


#TUVA4
tuva4_n <- sum(!is.na(article1tuva$DBP_TUVA4))
tuva4_n


#TUVA5
tuva5_n <- sum(!is.na(article1tuva$DBP_TUVA5))
tuva5_n



 

#UTUVA1
utuva1_n <- sum(!is.na(article1utuva$DBP_UTUVA1))
utuva1_n


#UTUVA2
utuva2_n <- sum(!is.na(article1utuva$DBP_UTUVA2))
utuva2_n

 
#UTUVA3
utuva3_n <- sum(!is.na(article1utuva$DBP_UTUVA3))
utuva3_n



```



# Count mean years of the visits in different time points of TUVA and UTUVA
<br><br>

Workflow:

1. convert character to date (where needed)
2. convert date to numeric
3. run `mean()`
4. convert the result back to date format
5. extract year





TUVA1 year:
 
<br><br><br>
```{r mean_year_of_TUVA1, echo=FALSE}

# Convert to numeric, then calculate mean
mean_tuva1_date <- mean(as.numeric(article1tuva$PAIVAMA_70_PVM), na.rm = TRUE)

# Convert back to date
mean_tuva1_date <- as.Date(mean_tuva1_date, origin = "1970-01-01")

# Extract year
tuva1_year <- year(mean_tuva1_date)

# Clean up
rm(mean_tuva1_date)

# Display year
tuva1_year

```
<br><br><br>


 
TUVA2 year:
 
<br><br><br>
```{r mean_year_of_TUVA2, echo=FALSE}


# Convert to date format  (as.Date produces automatically NAs where needed)
article1tuva$tuva2date <- as.Date(article1tuva$PAIVAMA_PVM_80)


# Convert to numeric, then calculate mean
mean_tuva2_date <- mean(as.numeric(article1tuva$tuva2date), na.rm = TRUE)

# Convert back to date
mean_tuva2_date <- as.Date(mean_tuva2_date, origin = "1970-01-01")

# Extract year
tuva2_year <- year(mean_tuva2_date)

# Clean up
rm(mean_tuva2_date)

# Display year
tuva2_year

```
<br><br><br>


 
 
TUVA3 year:
 
<br><br><br>
```{r mean_year_of_TUVA3, echo=FALSE}




# Convert to date format  (as.Date produces automatically NAs where needed)
article1tuva$tuva3date <- as.Date(article1tuva$CTUTPVM_85)


# Convert to numeric, then calculate mean
mean_tuva3_date <- mean(as.numeric(article1tuva$tuva3date), na.rm = TRUE)

# Convert back to date
mean_tuva3_date <- as.Date(mean_tuva3_date, origin = "1970-01-01")

# Extract year
tuva3_year <- year(mean_tuva3_date)

# Clean up
rm(mean_tuva3_date)

# Display year
tuva3_year

```
<br><br><br>


 
TUVA4 year:

Participants with the IDs:
997, 837, 201, 708, 1027, 117, 257, 360, 426, 442, 613, 627, 61

have erroneous data for exam date. Most of that is handled when that date variable is turned numeric. One participant's data in that cell has to corrected manually so that all the cells with erroneous data turn into NAs.


<br><br><br>
```{r mean_year_of_TUVA4, echo=FALSE}

# article1tuva$Tutkimuspaivamaara_F90
# is in Excel format, and contains some errors

# The erroneous values are in positions:
article1tuva %>% filter(ID1991 %in% c(997, 837, 201, 708,
                                      1027, 117, 257, 360,
                                      426, 442, 613, 627, 61)) %>%
                 select(Tutkimuspaivamaara_F90)

# Convert the Excel date to numeric
article1tuva$tuva4date <- as.numeric(article1tuva$Tutkimuspaivamaara_F90)

# Confirm that erroneous data turned into NAs
article1tuva %>% filter(ID1991 %in% c(997, 837, 201, 708,
                                      1027, 117, 257, 360,
                                      426, 442, 613, 627, 61)) %>%
                 select(ID1991, tuva4date)


# tuva4date for ID1991 == 997 remained as 1
article1tuva %>% filter(ID1991 %in% c(997)) %>%
                 select(ID1991, tuva4date)

# First, display the row index
which(article1tuva$ID1991 == 997)

# Fix the error
article1tuva[1013, "tuva4date"] <- NA

# Confirm
article1tuva %>% filter(ID1991 %in% c(997)) %>%
                 select(ID1991, tuva4date)

# Confirm all
article1tuva %>% filter(ID1991 %in% c(997, 837, 201, 708,
                                      1027, 117, 257, 360,
                                      426, 442, 613, 627, 61)) %>%
                 select(ID1991, tuva4date)


# Convert to numeric, then calculate mean
mean_tuva4date <- mean(as.numeric(article1tuva$tuva4date), na.rm = TRUE)

# Convert back to date
mean_tuva4date <- as.Date(mean_tuva4date, origin = "1899-12-30")

# Extract year
tuva4_year <- year(mean_tuva4date)

# Clean up
rm(mean_tuva4date)

# Turn article1tuva$tuva4date back to R date format for later use

article1tuva$tuva4date <- as.Date(article1tuva$tuva4date, origin = "1899-12-30")

```

TUVA4 year:

```{r TUVA4 year, echo=FALSE}
# Display year
tuva4_year 

```
<br><br><br>




TUVA5 year:
 
<br><br><br>
```{r mean_year_of_TUVA5, echo=FALSE}

 
# Convert to date format  (as.Date produces automatically NAs where needed)
article1tuva$tuva5date <- as.Date(article1tuva$FYSMIT_PVM_95, "%d.%m.%Y")

# Convert to numeric, then calculate mean
mean_tuva5_date <- mean(as.numeric(article1tuva$tuva5date), na.rm = TRUE)

# Convert back to date
mean_tuva5_date <- as.Date(mean_tuva5_date, origin = "1970-01-01")

# Extract year
tuva5_year <- year(mean_tuva5_date)

# Clean up
rm(mean_tuva5_date)

# Display year
tuva5_year

```
<br><br><br>

 

 


UTUVA1 year:
 
<br><br><br>
```{r mean_year_of_UTUVA1, echo=FALSE}

# Convert to date  (as.Date produces automatically NAs where needed)
article1utuva <- article1utuva %>% mutate(B8_3_PVM_U70 = as.Date(B8_3_PVM_U70, "%d.%m.%Y"))

# Convert to numeric, then calculate mean
mean_utuva1_date <- mean(as.numeric(article1utuva$B8_3_PVM_U70), na.rm = TRUE)

# Convert back to date
mean_utuva1_date <- as.Date(mean_utuva1_date, origin = "1970-01-01")

# Extract year
utuva1_year <- year(mean_utuva1_date)

# Clean up
rm(mean_utuva1_date)

# Display year
utuva1_year


```
<br><br><br>


 
UTUVA2 year:
 
<br><br><br>
```{r mean_year_of_UTUVA2, echo=FALSE}


# B10b_a_U75
# B10b_b_U75
# B10b_c_U75

# Form the date variable
article1utuva <- article1utuva %>% mutate(utuva2date = paste0(B10b_c_U75,"-", B10b_b_U75,"-", B10b_a_U75))

# Convert to date format  (as.Date produces automatically NAs where needed)
article1utuva$utuva2date <- as.Date(article1utuva$utuva2date)


# Convert to numeric, then calculate mean
mean_utuva2_date <- mean(as.numeric(article1utuva$utuva2date), na.rm = TRUE)

# Convert back to date
mean_utuva2_date <- as.Date(mean_utuva2_date, origin = "1970-01-01")

# Extract year
utuva2_year <- year(mean_utuva2_date)

# Clean up
rm(mean_utuva2_date)

# Display year
utuva2_year


```
<br><br><br>


 
 
UTUVA3 year:
 
<br><br><br>
```{r mean_year_of_UTUVA3, echo=FALSE}



# Convert to date format (as.Date produces automatically NAs where needed)
article1utuva$utuva3date <- as.Date(article1utuva$tutk_pvm, "%d.%m.%Y")
 

# Convert to numeric, then calculate mean
mean_utuva3_date <- mean(as.numeric(article1utuva$utuva3date), na.rm = TRUE)

# Convert back to date
mean_utuva3_date <- as.Date(mean_utuva3_date, origin = "1970-01-01")

# Extract year
utuva3_year <- year(mean_utuva3_date)

# Clean up
rm(mean_utuva3_date)

# Display year
utuva3_year 


```
<br><br><br>


 


# The mean DBPs of TUVA and UTUVA time points
<br><br>

Pay notice that the `na.rm = TRUE` has to be present. Otherwise the `mean()` function gives only `NA`.

 

```{r DBP_TUVA1}


tuva1_dbp <- mean(article1tuva$DBP_TUVA1, na.rm = TRUE)
tuva1_dbp

```


```{r DBP_TUVA2}

tuva2_dbp <- mean(article1tuva$DBP_TUVA2, na.rm = TRUE)
tuva2_dbp

```


```{r DBP_TUVA3}

tuva3_dbp <- mean(article1tuva$DBP_TUVA3, na.rm = TRUE)
tuva3_dbp


```


```{r DBP_TUVA4}

tuva4_dbp <- mean(article1tuva$DBP_TUVA4, na.rm = TRUE)
tuva4_dbp


```


```{r DBP_TUVA5}


tuva5_dbp <- mean(article1tuva$DBP_TUVA5, na.rm = TRUE)
tuva5_dbp

 
```


```{r DBP_UTUVA1}


utuva1_dbp <- mean(article1utuva$DBP_UTUVA1, na.rm = TRUE)
utuva1_dbp
 

```


```{r DBP_UTUVA2}


utuva2_dbp <- mean(article1utuva$DBP_UTUVA2, na.rm = TRUE)
utuva2_dbp


```


```{r DBP_UTUVA3}

utuva3_dbp <- mean(article1utuva$DBP_UTUVA3, na.rm = TRUE)
utuva3_dbp


```


 
 

# The mean ages in TUVA and UTUVA time points
<br><br>

Pay notice that the `na.rm = TRUE` has to be present. Otherwise the `mean()` function gives only `NA`.

 

```{r age_TUVA1}

 
tuva1_age <-  article1tuva %>% drop_na(DBP_TUVA1) %>% select(IKA_tutkpvm_70) %>% unlist() %>% mean(., na.rm = T)

tuva1_age

article1tuva %>% drop_na(SRR_70_istuen) %>% nrow()


```


```{r age_TUVA2}

# There is no age for the exam date, so we will have to use the age in the questionnaire

article1tuva$tuva2age <-  as.numeric(difftime(article1tuva$PAIVAMA_PVM_80, article1tuva$SyntPVM, units = "days") / 365.25)

 

tuva2_age <-  article1tuva %>% drop_na(DBP_TUVA2) %>% select(tuva2age) %>% unlist() %>% mean(., na.rm = T)

tuva2_age

article1tuva %>% drop_na(DBP_TUVA2) %>% nrow()

```


```{r age_TUVA3}

article1tuva$tuva3age <-  as.numeric(difftime(article1tuva$CTUTPVM_85, article1tuva$SyntPVM, units = "days") / 365.25)



tuva3_age <-  article1tuva %>% drop_na(DBP_TUVA3) %>% select(tuva3age) %>% unlist() %>% mean(., na.rm = T)

tuva3_age

article1tuva %>% drop_na(DBP_TUVA3) %>% nrow()
 


```


```{r age_TUVA4}

# TUVA4 age has been fixed (it had errors), use that
# tuva4date

article1tuva$tuva4age <-  as.numeric(difftime(article1tuva$tuva4date, article1tuva$SyntPVM, units = "days") / 365.25)
 
 
tuva4_age <-  article1tuva %>% drop_na(DBP_TUVA4) %>% select(tuva4age) %>% unlist() %>% mean(., na.rm = T)

tuva4_age


article1tuva %>% drop_na(DBP_TUVA4) %>% nrow()

```


```{r age_TUVA5}

# The exam date variable has already been fixed before, use that
# article1tuva$tuva5date

article1tuva$tuva5age <-  as.numeric(difftime(article1tuva$tuva5date, article1tuva$SyntPVM, units = "days") / 365.25)
 


tuva5_age <-  article1tuva %>% drop_na(DBP_TUVA5) %>% select(tuva5age) %>% unlist() %>% mean(., na.rm = T)

tuva5_age

article1tuva %>% drop_na(DBP_TUVA5) %>% nrow()
 
```


```{r age_UTUVA1}


# First, convert dates to date format

# (utuva$SyntPVM already is in date format)
is.Date(article1utuva$SyntPVM)

# # Convert exam date to date format
article1utuva$B8_3_PVM_U70 <- as.Date(article1utuva$B8_3_PVM_U70, format = "%d.%m.%Y")

# Confirm
is.Date(article1utuva$B8_3_PVM_U70)

# Calculate age
article1utuva$age <- as.numeric(difftime(article1utuva$B8_3_PVM_U70, article1utuva$SyntPVM, units = "days") / 365.25)

# Turns out that one age has erroneous data (age = 61.4 years)
min(article1utuva$age)

# Identify that person
article1utuva %>% select(ID1991, ID2011, SyntPVM, B8_3_PVM_U70, age) %>%  filter(age < 65 )

# (The person has for ID2011 the value 665)


# The exam date year is wrong. When we sort the data, the correct year is with almost
# 100% surity "2011":
sort(article1utuva$B8_3_PVM_U70) %>% head()
max(article1utuva$B8_3_PVM_U70)

# Correct that cell of data with Base R
#
#Find the row index where ID matches the erroneous_ID
#
row_index <- which(article1utuva$ID2011 == 665)

# Identify the column index
column_index <- which(colnames(article1utuva) == "B8_3_PVM_U70")

# Confirm
article1utuva[row_index, column_index]

# Correct the erroneous value
correct_date <- as.Date("2011-11-18", format = "%Y-%m-%d")
is.Date(correct_date)

article1utuva[row_index, column_index] <- correct_date

# Confirm
article1utuva[row_index, column_index]
is.Date(article1utuva$B8_3_PVM_U70)

# Recalculate ages
article1utuva$utuva1_age <- as.numeric(difftime(article1utuva$B8_3_PVM_U70, article1utuva$SyntPVM, units = "days") / 365.25)



utuva1_age <-  article1utuva %>% drop_na(DBP_UTUVA1) %>% select(utuva1_age) %>% unlist() %>% mean(., na.rm = T)

utuva1_age

article1utuva %>% drop_na(DBP_UTUVA1) %>% nrow()


```


```{r age_UTUVA2}
 
# The UTUVA2 date has already been created, use that:
# utuva2date
 

# Calculate ages
article1utuva$utuva2_age <- as.numeric(difftime(article1utuva$utuva2date, article1utuva$SyntPVM, units = "days") / 365.25)
 


utuva2_age <-  article1utuva %>% drop_na(DBP_UTUVA2) %>% select(utuva2_age) %>% unlist() %>% mean(., na.rm = T)

utuva2_age

article1utuva %>% drop_na(DBP_UTUVA2) %>% nrow()


```


```{r age_UTUVA3}
 
# The UTUVA3 date has already been created, use that:
# utuva3date

# Calculate ages
article1utuva$utuva3_age <- as.numeric(difftime(article1utuva$utuva3date, article1utuva$SyntPVM, units = "days") / 365.25)
 


utuva3_age <-  article1utuva %>% drop_na(DBP_UTUVA3) %>% select(utuva3_age) %>% unlist() %>% mean(., na.rm = T)

utuva3_age



article1utuva %>% drop_na(DBP_UTUVA3) %>% nrow()


```



 

# Within cohort comparisons with the paired t-test
<br><br>

Now we run the t-tests.

**It is utterly important to pay attention that these has to be paired t-tests, since we are comparing the DBPs from same individuals measured in two different time points.**


Paired t-test TUVA1 vs TUVA2:

<br><br><br>
```{r t-test_DBPs_TUVA1_TUVA2}

 

# Run model
tuva1_vs_tuva2 <-t.test(article1tuva$DBP_TUVA1, article1tuva$DBP_TUVA2, paired=TRUE)

tuva1_vs_tuva2

# Extract p-value
tuva1_vs_tuva2_p <- tuva1_vs_tuva2$p.value
tuva1_vs_tuva2_p

# Stylize
tuva1_vs_tuva2_p <- stylize_p(tuva1_vs_tuva2_p)

```
<br><br><br>

 
 
 Paired t-test TUVA1 vs TUVA3:

 
<br><br><br>
```{r t-test_DBPs_TUVA1_TUVA3}

# Run model
tuva1_vs_tuva3 <-t.test(article1tuva$DBP_TUVA1, article1tuva$DBP_TUVA3, paired=TRUE)
tuva1_vs_tuva3

# Extract p-value
tuva1_vs_tuva3_p <- tuva1_vs_tuva3$p.value
tuva1_vs_tuva3_p

# Stylize
tuva1_vs_tuva3_p <- stylize_p(tuva1_vs_tuva3_p)

```
<br><br><br>

Paired t-test TUVA1 vs TUVA4:


```{r t-test_DBPs_TUVA1_TUVA4}


 
# Run model
tuva1_vs_tuva4 <-t.test(article1tuva$DBP_TUVA1, article1tuva$DBP_TUVA4, paired=TRUE)
tuva1_vs_tuva4

# Extract p-value
tuva1_vs_tuva4_p <- tuva1_vs_tuva4$p.value
tuva1_vs_tuva4_p

# Stylize
tuva1_vs_tuva4_p <- stylize_p(tuva1_vs_tuva4_p)

```
<br><br><br>

Paired t-test TUVA1 vs TUVA5:

```{r t-test_DBPs_TUVA1_TUVA5}


 
# Run model
tuva1_vs_tuva5 <-t.test(article1tuva$DBP_TUVA1, article1tuva$DBP_TUVA5, paired=TRUE)
tuva1_vs_tuva5

# Extract p-value
tuva1_vs_tuva5_p <- tuva1_vs_tuva5$p.value
tuva1_vs_tuva5_p

# Stylize
tuva1_vs_tuva5_p <- stylize_p(tuva1_vs_tuva5_p)

```

Paired t-test UTUVA1 vs UTUVA2:



```{r t-test_DBPs_UTUVA1_UTUVA2}
 
 
# Run model
utuva1_vs_utuva2 <-t.test(article1utuva$DBP_UTUVA1, article1utuva$DBP_UTUVA2, paired=TRUE)

utuva1_vs_utuva2

# Extract p-value
utuva1_vs_utuva2_p <- utuva1_vs_utuva2$p.value
utuva1_vs_utuva2_p

# Stylize
utuva1_vs_utuva2_p <- stylize_p(utuva1_vs_utuva2_p)


```


Paired t-test UTUVA1 vs UTUVA3:


```{r t-test_DBPs_UTUVA1_UTUVA3}
 
  
# Run model
utuva1_vs_utuva3 <-t.test(article1utuva$DBP_UTUVA1, article1utuva$DBP_UTUVA3, paired=TRUE)

utuva1_vs_utuva3

# Extract p-value
utuva1_vs_utuva3_p <- utuva1_vs_utuva3$p.value
utuva1_vs_utuva3_p
 
# Stylize
utuva1_vs_utuva3_p <- stylize_p(utuva1_vs_utuva3_p)


```


# Comparison of DBPs between cohorts with un-paired t-tests
<br><br>

When you compare the two different cohorts, the following is utterly important:

- **YOU CANNOT USE THE PAIRED T-TEST ANYMORE. HENCE, "PAIRED: FALSE"**

Let us start by counting:

1. the mean DBPs for TUVA1 and UTUVA1
2. their subtraction

<br><br><br>
```{r subtraction_DBPs_TUVA1_UTUVA1}
 
tuva1_utuva1_subtraction <- mean(article1tuva$DBP_TUVA1, na.rm = TRUE) - mean(article1utuva$DBP_UTUVA1, na.rm = TRUE)

```
<br><br><br>
 
Thereafter, let us run the t-test.

**PAY ATTENTION: UNPAIRED T-TEST!!!**

(paired=FALSE)
 

<br><br><br>
```{r t-test_DBPs_TUVA1_UTUVA1}
 
# Run model
tuva1_vs_utuva1 <-t.test(article1tuva$DBP_TUVA1, article1utuva$DBP_UTUVA1, paired=FALSE)

tuva1_vs_utuva1

# Extract p-value
tuva1_vs_utuva1_p <- tuva1_vs_utuva1$p.value
tuva1_vs_utuva1_p

# Stylize
tuva1_vs_utuva1_p <- stylize_p(tuva1_vs_utuva1_p)
  
```
<br><br><br>


Subtraction of means of TUVA2 and UTUVA3

<br><br><br>
```{r subtraction_DBPs_TUVA2_UTUVA3}
 
tuva2_utuva3_subtraction <- mean(article1tuva$DBP_TUVA2, na.rm = TRUE) - mean(article1utuva$DBP_UTUVA3, na.rm = TRUE)



```
<br><br><br>

t-test UTUVA3 vs TUVA2:

```{r t-test_DBPs_TUVA2_UTUVA3}
 
# Run model
tuva2_vs_utuva3 <-t.test(article1tuva$DBP_TUVA2, article1utuva$DBP_UTUVA3, paired=FALSE)

tuva2_vs_utuva3

# Extract p-value
tuva2_vs_utuva3_p <- tuva2_vs_utuva3$p.value
tuva2_vs_utuva3_p

# Stylize
tuva2_vs_utuva3_p <- stylize_p(tuva2_vs_utuva3_p)

```





# Compose Table 2 of the results


<br><br><br>
```{r table2}
 
##################################################################
##                             TUVA                             ##
##################################################################


table2_part1 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
  "Year",  tuva1_year, 0, tuva2_year, tuva3_year, tuva4_year, tuva5_year,
    "n", tuva1_n, 0, tuva2_n, tuva3_n, tuva4_n, tuva5_n,
  )# %>% as.data.frame()

table2_part1 <- table2_part1 %>% 
  mutate(across(where(is.numeric), ~ round_half_up(., digits = 0))) %>% 
  mutate(across(where(is.numeric), ~ as.character(.)))


table2_part2 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
    "Mean age (years)", tuva1_age, NA,  tuva2_age, tuva3_age, tuva4_age, tuva5_age,
   "DBP (mmHg)", tuva1_dbp, 0, tuva2_dbp, tuva3_dbp, tuva4_dbp, tuva5_dbp
  ) #%>% as.data.frame()

table2_part2 <- table2_part2 %>% 
  mutate(across(where(is.numeric), ~ round_half_up(., digits = 1))) %>% 
  mutate(across(where(is.numeric), ~ as.character(.)))



table2_part3 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
   "p-value", "", "", tuva1_vs_tuva2_p, tuva1_vs_tuva3_p, tuva1_vs_tuva4_p, tuva1_vs_tuva5_p
  )


#################################################################
##                            UTUVA                            ##
#################################################################

table2_part4 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
  "Year",  utuva1_year, utuva2_year, utuva3_year, NA, NA, NA,
    "n", utuva1_n, utuva2_n, utuva3_n, NA, NA, NA
  )

table2_part4 <- table2_part4 %>% 
  mutate(across(where(is.numeric), ~ round_half_up(., digits = 0))) %>% 
  mutate(across(where(is.numeric), ~ as.character(.)))




table2_part5 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
  
  "Mean age (years)", utuva1_age, utuva2_age, utuva3_age,  NA, NA, NA,
   "DBP (mmHg)", utuva1_dbp, utuva2_dbp, utuva3_dbp, NA, NA, NA
  )  

table2_part5 <- table2_part5 %>% 
  mutate(across(where(is.numeric), ~ round_half_up(., digits = 1))) %>% 
  mutate(across(where(is.numeric), ~ as.character(.)))



table2_part6 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
   "p-value", "", utuva1_vs_utuva2_p, utuva1_vs_utuva3_p, "", "", ""
  )

 
table2_part7 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
   "Difference in DBP between cohorts (mmHg)", tuva1_utuva1_subtraction, "", tuva2_utuva3_subtraction, "", "", ""
  )

 
table2_part7 <- table2_part7 %>% 
  mutate(across(where(is.numeric), ~ round_half_up(., digits = 1))) %>% 
  mutate(across(where(is.numeric), ~ as.character(.)))

 

table2_part8 <- 
tibble::tribble(
  ~Cohort,    ~I, ~II,  ~III,   ~IV,    ~V,   ~VI,
   "p-value", tuva1_vs_utuva1_p, "", tuva2_vs_utuva3_p, "", "", ""
  )

table2 <- 
rbind(table2_part1,
table2_part2,
table2_part3,
table2_part4,
table2_part5,
table2_part6,
table2_part7,
table2_part8)


table2 <- table2 %>% add_row(Cohort="TUVA",
                             I="",
                             II="",
                             III="",
                             IV="",
                             V="",
                             VI="",
                           .before=1)

 table2 <- table2 %>% add_row(Cohort="UTUVA",
                              I="",
                              II="",
                              III="",
                              IV="",
                              V="",
                              VI="",
                            .before=7)




table2 %>% kable() %>% kable_styling()


```
<br><br><br>
 


